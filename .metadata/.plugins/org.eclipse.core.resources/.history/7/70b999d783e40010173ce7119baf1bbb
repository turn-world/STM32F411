/*
 * usb.c
 *
 *  Created on: 2020. 12. 9.
 *      Author: baram
 */


#include "usb.h"


#ifdef _USE_HW_USB
#include "usbd_core.h"
#include "usbd_cdc.h"
#include "usbd_cdc_if.h"

#if HW_USE_CDC == 1
static bool is_init = false;
static UsbMode is_usb_mode = USB_NON_MODE;
#endif

extern USBD_DescriptorsTypeDef FS_Desc;			//나중에 msc를 추가하면 헤더파일 이름이 똑같아 져서 헤더를 가져오지 않고 extern으로 가져옴

USBD_HandleTypeDef hUsbDeviceFS;

bool usbInit(void)
{
  bool ret = true;

  return ret;
}

void usbDeInit(void)
{

}

UsbMode usbGetMode(void)
{
	return is_usb_mode;
}

bool usbBegin(UsbMode usb_mode)
{
	bool ret = false;
#if HW_USE_CDC == 1
	if(usb_mode == USB_CDC_MODE)
	{
		if (USBD_Init(&hUsbDeviceFS, &FS_Desc, DEVICE_FS) != USBD_OK)
		{
		  return false;
		}
		if (USBD_RegisterClass(&hUsbDeviceFS, &USBD_CDC) != USBD_OK)
		{
			return false;
		}
		if (USBD_CDC_RegisterInterface(&hUsbDeviceFS, &USBD_Interface_fops_FS) != USBD_OK)
		{
			return false;
		}
		if (USBD_Start(&hUsbDeviceFS) != USBD_OK)
		{
			return false;
		}
		cdcInit();
		ret = true;
		is_usb_mode = USB_CDC_MODE;
	}
#endif



	is_init = ret;

	return ret;
}


#endif
